# 문서 로딩 최적화 가이드

> 토큰 효율을 위한 문서 로딩 규칙

---

## 핵심 원칙

1. **필요할 때만 로딩** - 전체 문서를 미리 읽지 않음
2. **인덱스 우선 참조** - 전체 맵 대신 JSON 인덱스 사용
3. **섹션 단위 로딩** - 필요한 섹션만 선택적 읽기
4. **캐싱 활용** - 같은 세션 내 중복 로딩 금지

---

## 로딩 우선순위

### 1단계: 인덱스만 로딩
```
.claude/docs/dependency-index.json
```
- 의존성 관계 빠른 조회
- 에이전트-문서 매핑 확인
- 전체 맵 파싱 불필요

### 2단계: 필요시 상세 문서
```
dependency-map.md  → 비고/컨텍스트 필요시
docs-mapping.md    → 에이전트 역할 확인시
```

---

## 에이전트별 로딩 규칙

### 작업 시작 시
```
1. dependency-index.json 로딩 (필수)
2. 담당 문서 목록 확인 (agentMapping)
3. 작업 대상 문서만 로딩
```

### 문서 수정 시
```
1. 수정 대상 문서 로딩
2. dependencies[파일명]으로 연관 문서 확인
3. 연관 문서는 목록만 확인 (내용 로딩 X)
4. 사용자 승인 후 연관 문서 로딩
```

### 의존성 확인 시
```python
# 권장: JSON 인덱스 사용
deps = index["dependencies"]["cards.md"]
# → ["class-advancement.md", "warrior.md", "paladin.md"]

# 비권장: 전체 맵 파싱
grep "cards.md" dependency-map.md
```

---

## 섹션 로딩 패턴

### 문서 구조 파악만 필요시
```
Read: 1-30 lines (목차/개요만)
```

### 특정 섹션 수정시
```
1. 전체 문서 읽기
2. 수정 대상 섹션 식별
3. Edit 도구로 해당 섹션만 수정
```

### 참조만 필요시
```
Grep: 특정 키워드로 위치 파악
Read: 해당 라인 주변만 로딩 (offset/limit)
```

---

## 캐싱 규칙

### 세션 내 캐싱
- 한 번 읽은 인덱스는 재로딩 금지
- 수정하지 않은 문서는 재로딩 금지

### 캐시 무효화
- 문서 수정 후에는 해당 문서 재로딩 허용
- 새 세션 시작 시 캐시 리셋

---

## 토큰 절약 예시

### Before (비효율)
```
1. dependency-map.md 전체 로딩 (74줄)
2. docs-mapping.md 전체 로딩 (108줄)
3. 모든 담당 문서 로딩
→ 총 500+ 줄 로딩
```

### After (최적화)
```
1. dependency-index.json 로딩 (30줄)
2. 작업 대상 문서만 로딩
→ 총 100줄 이하
```

---

## 변경 이력

| 날짜 | 변경 내용 |
|------|----------|
| 2026-01-10 | 최초 생성 |
